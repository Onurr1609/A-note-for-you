<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>A Note For You</title>
<style>
  :root{
    --bg:#000;
    --paper1:#b9ab97;
    --paper2:#a99b86;
    --ink:#0b0b0b;
    --line:rgba(0,0,0,.18);
    --shadow:rgba(0,0,0,.55);
    --white:rgba(255,255,255,.92);
    --muted:rgba(255,255,255,.72);
    --muted2:rgba(255,255,255,.58);
    --border:rgba(255,255,255,.14);
  }

  html,body{height:100%}
  body{
    margin:0;
    background:var(--bg);
    color:var(--white);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    overflow-x:hidden;
  }

  .wrap{
    min-height:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    padding:24px 16px 28px;
    box-sizing:border-box;
    gap:14px;
  }

  .top{
    width:min(520px, 100%);
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:6px;
    text-align:center;
    margin-top:6px;
  }

  .title{
    font-size:18px;
    font-weight:500;
    letter-spacing:.2px;
  }

  .sub{
    font-size:13px;
    color:var(--muted);
    display:flex;
    flex-direction:column;
    gap:2px;
  }

  .row{
    display:flex;
    gap:10px;
    justify-content:center;
    flex-wrap:wrap;
  }

  .chip{
    font-size:12px;
    padding:6px 10px;
    border:1px solid var(--border);
    border-radius:999px;
    color:var(--muted);
    background:rgba(255,255,255,.03);
  }

  .stage{
    width:min(520px, 100%);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:8px 0 2px;
  }

  .note{
    position:relative;
    width:min(420px, 92vw);
    aspect-ratio: 16/9;
    user-select:none;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
    cursor:pointer;
    transform-origin:center;
    filter: drop-shadow(0 18px 30px var(--shadow));
  }

  .paper{
    position:absolute;
    inset:0;
    background:
      linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.06)),
      repeating-linear-gradient(180deg, transparent 0 22px, var(--line) 22px 23px),
      radial-gradient(120% 90% at 20% 10%, rgba(255,255,255,.18), transparent 60%),
      linear-gradient(90deg, var(--paper1), var(--paper2));
    border-radius:10px;
    clip-path: polygon(
      4% 6%, 92% 3%, 97% 13%, 96% 70%,
      85% 88%, 52% 94%, 28% 90%, 8% 84%, 3% 68%
    );
    transform: translateZ(0);
  }

  .crumple{
    position:absolute;
    inset:0;
    background:
      radial-gradient(120px 80px at 20% 30%, rgba(0,0,0,.12), transparent 60%),
      radial-gradient(160px 120px at 70% 20%, rgba(0,0,0,.10), transparent 65%),
      radial-gradient(220px 160px at 60% 70%, rgba(0,0,0,.10), transparent 70%),
      linear-gradient(120deg, rgba(255,255,255,.12), transparent 45%),
      linear-gradient(300deg, rgba(255,255,255,.10), transparent 50%);
    mix-blend-mode:multiply;
    opacity:.82;
    border-radius:10px;
    clip-path: inherit;
    transform: translateZ(0);
  }

  .text{
    position:relative;
    padding:18px 22px;
    color:var(--ink);
    font-family: ui-rounded, "Bradley Hand", "Comic Sans MS", system-ui;
    font-size: clamp(18px, 4.2vw, 28px);
    line-height:1.15;
    letter-spacing:.2px;
    text-align:left;
    opacity:0;
    transform: translateY(10px);
    transition: opacity 520ms ease, transform 580ms ease;
    width:92%;
  }

  .heart{
    position:absolute;
    right:14px;
    bottom:10px;
    color:rgba(0,0,0,.55);
    font-size:20px;
    opacity:0;
    transform: translateY(6px);
    transition: opacity 520ms ease, transform 580ms ease;
    pointer-events:none;
  }

  .hint{
    width:min(520px, 100%);
    text-align:center;
    color:var(--muted);
    font-size:13px;
    padding:0 8px;
    min-height:18px;
  }

  .weather{
    width:min(520px, 100%);
    text-align:center;
    display:none;
    color:var(--white);
    font-size:14px;
    line-height:1.3;
    margin-top:2px;
  }

  .weather .wtitle{
    font-size:13px;
    color:var(--muted);
    margin-bottom:4px;
  }

  .footer{
    width:min(520px, 100%);
    text-align:center;
    color:var(--muted2);
    font-size:13px;
    margin-top:2px;
    min-height:18px;
  }

  .actions{
    width:min(520px, 100%);
    display:flex;
    justify-content:center;
    gap:10px;
    margin-top:6px;
  }

  .btn{
    background:transparent;
    color:var(--white);
    border:1px solid var(--border);
    border-radius:999px;
    padding:8px 12px;
    font-size:13px;
  }

  .btn:active{transform:scale(.98)}

  .panel{
    width:min(520px, 100%);
    display:none;
    flex-direction:column;
    gap:10px;
    border-top:1px solid rgba(255,255,255,.12);
    padding-top:14px;
    margin-top:2px;
  }

  .panelTitle{
    font-size:14px;
    font-weight:600;
    color:var(--muted);
    letter-spacing:.2px;
  }

  .archive{
    display:flex;
    flex-direction:column;
    gap:10px;
  }

  .card{
    border:1px solid var(--border);
    border-radius:14px;
    padding:12px;
    background: rgba(255,255,255,.03);
  }

  .meta{
    font-size:12px;
    color:var(--muted2);
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    justify-content:space-between;
    margin-bottom:6px;
  }

  .msg{
    font-size:14px;
    line-height:1.35;
    color:var(--white);
    white-space:pre-wrap;
  }

  .state0 .note{transform: scale(.86) rotate(-1.2deg)}
  .state0 .paper{transform: scale(.92) rotate(1.8deg)}
  .state0 .text{opacity:0}
  .state0 .heart{opacity:0}

  .state1 .note{
    transform: scale(.95) rotate(-.4deg);
    transition: transform 560ms cubic-bezier(.2,.9,.2,1);
  }
  .state1 .paper{
    transform: scale(.98) rotate(.3deg);
    transition: transform 560ms cubic-bezier(.2,.9,.2,1);
  }

  .state2 .note{
    transform: scale(1) rotate(0deg);
    transition: transform 660ms cubic-bezier(.2,.9,.2,1);
  }
  .state2 .paper{
    transform: scale(1) rotate(0deg);
    transition: transform 660ms cubic-bezier(.2,.9,.2,1);
  }
  .state2 .text{
    opacity:1;
    transform: translateY(0);
  }
  .state2 .heart{
    opacity:1;
    transform: translateY(0);
  }

  .locked .note{opacity:.58; pointer-events:none}
  .locked .hint{color:var(--white)}
</style>
</head>

<body>
  <div class="wrap state0" id="app">
    <div class="top">
      <div class="title">A Note For You</div>
      <div class="sub">
        <div id="dateLine"></div>
        <div class="row">
          <div class="chip" id="togetherLine"></div>
          <div class="chip" id="daysLine"></div>
        </div>
      </div>
    </div>

    <div class="stage">
      <div class="note" id="note">
        <div class="paper"></div>
        <div class="crumple"></div>
        <div class="text" id="noteText"></div>
        <div class="heart" id="heart">♥</div>
      </div>
    </div>

    <div class="hint" id="hint">Tap gently.</div>

    <div class="weather" id="weather"></div>

    <div class="footer" id="footer"></div>

    <div class="actions">
      <button class="btn" id="toggleArchive">Archive</button>
      <button class="btn" id="resetLocal">Reset (this phone)</button>
    </div>

    <div class="panel" id="panel">
      <div class="panelTitle">Opened notes</div>
      <div class="archive" id="archive"></div>
    </div>
  </div>

<script>
  const RELATIONSHIP_START = "2022-07-03";

  const NOTES = [
    "I’m proud of you.",
    "I’m seeing you improve, and it makes me so happy.",
    "You’re doing so well. Keep going.",
    "I believe in you, even on the hard days.",
    "I’m proud of the way you handle life.",
    "You have such a kind heart. I love that about you.",
    "You make me feel safe and loved. Thank you.",
    "I’m so happy you got a great internship. You deserve it.",
    "I love how gentle you are with me.",
    "You’re stronger than you think.",
    "If today feels heavy, I’m still right here.",
    "You don’t need to be perfect. You’re enough.",
    "I love the way you care about people.",
    "I’m proud of your progress. I notice it.",
    "You inspire me to be better.",
    "I can’t wait to live with you one day.",
    "You’re my favorite person to come home to.",
    "I’m grateful for you, every day.",
    "You’re doing amazing, even if it doesn’t feel like it.",
    "Your smile is my comfort.",
    "I love our little world.",
    "I’m proud of how you keep going.",
    "You’re so lovable, exactly as you are.",
    "I’m lucky to have you.",
    "I’m always on your side.",
    "I trust you. I’m here for you.",
    "You make life softer for me.",
    "Today, be gentle with yourself.",
    "I love you more than you know.",
    "One day closer to being together for real."
  ];

  const LAT = 55.4038;
  const LON = 10.4024;

  const KEY = "cute_notes_private_v3";

  const app = document.getElementById("app");
  const dateLine = document.getElementById("dateLine");
  const togetherLine = document.getElementById("togetherLine");
  const daysLine = document.getElementById("daysLine");
  const note = document.getElementById("note");
  const noteText = document.getElementById("noteText");
  const hint = document.getElementById("hint");
  const weatherBox = document.getElementById("weather");
  const footer = document.getElementById("footer");
  const panel = document.getElementById("panel");
  const archiveEl = document.getElementById("archive");
  const toggleArchive = document.getElementById("toggleArchive");
  const resetLocal = document.getElementById("resetLocal");

  const pad = n => String(n).padStart(2, "0");
  const isoDate = d => `${d.getUTCFullYear()}-${pad(d.getUTCMonth()+1)}-${pad(d.getUTCDate())}`;
  const isoDateTime = d => `${isoDate(d)} ${pad(d.getUTCHours())}:${pad(d.getUTCMinutes())}`;

  function load(){
    try{
      const v = JSON.parse(localStorage.getItem(KEY));
      if(v && typeof v === "object") return v;
      return { opened:{}, archive:[] };
    }catch(e){
      return { opened:{}, archive:[] };
    }
  }

  function save(s){
    localStorage.setItem(KEY, JSON.stringify(s));
  }

  function hashToIndex(s){
    let h = 0;
    for(let i=0;i<s.length;i++) h = (h*31 + s.charCodeAt(i)) >>> 0;
    return h % NOTES.length;
  }

  function addMonthsUTC(d, months){
    const y = d.getUTCFullYear();
    const m = d.getUTCMonth();
    const day = d.getUTCDate();
    const target = new Date(Date.UTC(y, m + months, 1));
    const last = new Date(Date.UTC(target.getUTCFullYear(), target.getUTCMonth() + 1, 0)).getUTCDate();
    target.setUTCDate(Math.min(day, last));
    return target;
  }

  function diffYMDUTC(start, end){
    if(end < start) return {years:0, months:0, days:0, totalDays:0};

    let y = end.getUTCFullYear() - start.getUTCFullYear();
    let anchor = new Date(Date.UTC(start.getUTCFullYear() + y, start.getUTCMonth(), start.getUTCDate()));
    if(anchor > end){
      y--;
      anchor = new Date(Date.UTC(start.getUTCFullYear() + y, start.getUTCMonth(), start.getUTCDate()));
    }

    let m = 0;
    for(let i=0;i<12;i++){
      const next = addMonthsUTC(anchor, 1);
      if(next <= end){
        anchor = next;
        m++;
      }else{
        break;
      }
    }

    const totalDays = Math.floor((Date.UTC(end.getUTCFullYear(), end.getUTCMonth(), end.getUTCDate()) - Date.UTC(start.getUTCFullYear(), start.getUTCMonth(), start.getUTCDate())) / 86400000);
    const days = Math.floor((Date.UTC(end.getUTCFullYear(), end.getUTCMonth(), end.getUTCDate()) - Date.UTC(anchor.getUTCFullYear(), anchor.getUTCMonth(), anchor.getUTCDate())) / 86400000);

    return { years:y, months:m, days:days, totalDays:totalDays };
  }

  function weatherText(code){
    const map = {
      0:"Clear",
      1:"Mostly clear",
      2:"Partly cloudy",
      3:"Overcast",
      45:"Fog",
      48:"Fog",
      51:"Drizzle",
      53:"Drizzle",
      55:"Drizzle",
      56:"Freezing drizzle",
      57:"Freezing drizzle",
      61:"Rain",
      63:"Rain",
      65:"Heavy rain",
      66:"Freezing rain",
      67:"Freezing rain",
      71:"Snow",
      73:"Snow",
      75:"Heavy snow",
      77:"Snow grains",
      80:"Rain showers",
      81:"Rain showers",
      82:"Heavy showers",
      85:"Snow showers",
      86:"Snow showers",
      95:"Thunderstorm",
      96:"Thunderstorm",
      99:"Thunderstorm"
    };
    return map[code] || "Weather";
  }

  function windLabel(kmh){
    if(kmh < 10) return "Light wind";
    if(kmh < 22) return "Breezy";
    if(kmh < 35) return "Windy";
    return "Very windy";
  }

  function advice(tempC, code, windKmh){
    const t = tempC;
    if(code >= 61 && code <= 82) return "Maybe take an umbrella.";
    if(code >= 71 && code <= 86) return "Dress warm today.";
    if(windKmh >= 22 && t < 12) return "A warm jacket might be nice.";
    if(t <= 2) return "Bundle up today.";
    if(t < 8) return "A warm jacket might be nice.";
    if(t >= 22) return "A light outfit might be nice.";
    return "Have a soft day.";
  }

  async function showWeather(){
    try{
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&current_weather=true`;
      const res = await fetch(url, { cache:"no-store" });
      const w = await res.json();
      const cw = w.current_weather;
      if(!cw) return;

      const t = Math.round(cw.temperature);
      const code = cw.weathercode;
      const ws = Math.round(cw.windspeed);
      const wt = weatherText(code);
      const wl = windLabel(ws);
      const adv = advice(t, code, ws);

      weatherBox.innerHTML = `<div class="wtitle">Today in Odense</div>${t}°C · ${wt} · ${wl}<br>${adv}`;
      weatherBox.style.display = "block";
    }catch(e){}
  }

  function renderArchive(state){
    const items = [...state.archive].sort((a,b)=> (b.openedAt||"").localeCompare(a.openedAt||""));
    archiveEl.innerHTML = "";
    if(!items.length){
      const c = document.createElement("div");
      c.className = "card";
      c.innerHTML = `<div class="msg">No opened notes yet.</div>`;
      archiveEl.appendChild(c);
      return;
    }
    for(const it of items){
      const card = document.createElement("div");
      card.className = "card";
      const meta = document.createElement("div");
      meta.className = "meta";
      meta.innerHTML = `<span>Note: ${it.noteDate}</span><span>Opened: ${it.openedAt}</span>`;
      const msg = document.createElement("div");
      msg.className = "msg";
      msg.textContent = it.text;
      card.appendChild(meta);
      card.appendChild(msg);
      archiveEl.appendChild(card);
    }
  }

  function setState(n){
    app.classList.remove("state0","state1","state2");
    app.classList.add(`state${n}`);
  }

  function init(){
    const state = load();

    const now = new Date();
    const today = isoDate(now);

    dateLine.textContent = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate()))
      .toLocaleDateString("en-US", { weekday:"long", year:"numeric", month:"long", day:"numeric", timeZone:"UTC" });

    const start = new Date(RELATIONSHIP_START + "T00:00:00Z");
    const end = new Date(Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate()));
    const d = diffYMDUTC(start, end);

    togetherLine.textContent = `Together for ${d.years} years, ${d.months} months, ${d.days} days`;
    daysLine.textContent = `${d.totalDays} days`;

    const idx = hashToIndex(today);
    const text = NOTES[idx];
    noteText.textContent = text;

    const already = !!state.opened[today];

    if(already){
      app.classList.add("locked");
      setState(2);
      hint.textContent = "";
      footer.textContent = "Come back tomorrow.";
      showWeather();
    }else{
      app.classList.remove("locked");
      setState(0);
      hint.textContent = "Tap gently.";
      footer.textContent = "";
      weatherBox.style.display = "none";
    }

    renderArchive(state);

    let step = 0;

    note.addEventListener("click", () => {
      const s = load();
      if(s.opened[today]) return;

      if(step === 0){
        step = 1;
        setState(1);
        hint.textContent = "One more time.";
        return;
      }

      step = 2;
      setState(2);
      hint.textContent = "";
      footer.textContent = "I’ll leave another note for you tomorrow.";

      s.opened[today] = true;
      const openedAt = isoDateTime(new Date());
      s.archive.push({ noteDate: today, openedAt, text });
      save(s);

      showWeather();
      renderArchive(s);

      setTimeout(() => {
        app.classList.add("locked");
      }, 700);
    });

    toggleArchive.addEventListener("click", () => {
      panel.style.display = panel.style.display === "flex" ? "none" : "flex";
    });

    resetLocal.addEventListener("click", () => {
      localStorage.removeItem(KEY);
      location.reload();
    });
  }

  init();
</script>
</body>
</html>
