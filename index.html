<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A Note For You</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#000;
      --paper1:#c7b08f;
      --paper2:#bda27d;
      --paper3:#a88d69;
      --ink:#1f3a5f;
      --ink2:#0f2139;
      --line:rgba(31,58,95,.18);
      --white:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.72);
      --muted2:rgba(255,255,255,.56);
      --chip:rgba(255,255,255,.08);
      --chipBorder:rgba(255,255,255,.14);
      --shadow:rgba(0,0,0,.58);
      --ease:cubic-bezier(.22,1,.36,1);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:radial-gradient(1200px 700px at 50% 20%, rgba(255,255,255,.06), transparent 55%), var(--bg);
      color:var(--white);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-x:hidden;
    }

    .wrap{
      min-height:100%;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:32px 16px 22px;
    }
    .app{
      width:min(540px, 100%);
      text-align:center;
      position:relative;
    }

    h1{
      margin:10px 0 6px;
      font-size:26px;
      font-weight:600;
      letter-spacing:.2px;
    }
    .date{
      font-size:14px;
      color:var(--muted2);
      margin-bottom:12px;
    }

    .chips{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-bottom:18px;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background:var(--chip);
      border:1px solid var(--chipBorder);
      color:var(--muted);
      font-size:13px;
      line-height:1;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .chip strong{
      font-weight:600;
      color:var(--white);
    }

    .paperStage{
      width:100%;
      display:flex;
      justify-content:center;
      margin:4px 0 16px;
      position:relative;
    }

    .paper{
      width:min(460px, 92vw);
      aspect-ratio: 16 / 9;
      border-radius:18px;
      position:relative;
      transform-origin:center;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color:transparent;
      filter: drop-shadow(0 20px 28px var(--shadow));
    }

    .sheet{
      position:absolute; inset:0;
      border-radius:18px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,0) 18%),
        linear-gradient(180deg, transparent 0 10.5%, var(--line) 10.5% 11%, transparent 11% 21.5%, var(--line) 21.5% 22%, transparent 22% 32.5%, var(--line) 32.5% 33%, transparent 33% 43.5%, var(--line) 43.5% 44%, transparent 44% 54.5%, var(--line) 54.5% 55%, transparent 55% 65.5%, var(--line) 65.5% 66%, transparent 66% 76.5%, var(--line) 76.5% 77%, transparent 77% 87.5%, var(--line) 87.5% 88%, transparent 88% 100%),
        radial-gradient(120% 120% at 30% 15%, rgba(255,255,255,.22), rgba(255,255,255,0) 45%),
        radial-gradient(120% 140% at 85% 70%, rgba(0,0,0,.16), rgba(0,0,0,0) 55%),
        linear-gradient(135deg, var(--paper1), var(--paper2));
      overflow:hidden;
      clip-path: polygon(6% 8%, 94% 7%, 96% 16%, 96% 82%, 88% 93%, 14% 92%, 6% 86%, 5% 18%);
      transition: clip-path 900ms var(--ease), transform 900ms var(--ease), filter 900ms var(--ease);
    }

    .sheet::before{
      content:"";
      position:absolute; inset:-25px;
      background:
        radial-gradient(120px 80px at 18% 30%, rgba(0,0,0,.12), transparent 60%),
        radial-gradient(140px 110px at 62% 24%, rgba(0,0,0,.10), transparent 62%),
        radial-gradient(160px 120px at 78% 55%, rgba(0,0,0,.12), transparent 62%),
        radial-gradient(180px 120px at 35% 72%, rgba(0,0,0,.10), transparent 65%),
        linear-gradient(25deg, rgba(255,255,255,.10), transparent 35%),
        linear-gradient(-25deg, rgba(0,0,0,.08), transparent 35%);
      mix-blend-mode:multiply;
      opacity:.85;
      filter: blur(.2px);
    }

    .sheet::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(70% 60% at 20% 35%, rgba(255,255,255,.16), transparent 55%),
        radial-gradient(60% 70% at 80% 70%, rgba(255,255,255,.08), transparent 55%),
        linear-gradient(90deg, rgba(0,0,0,.08), transparent 18%, transparent 82%, rgba(0,0,0,.08));
      opacity:.65;
      pointer-events:none;
    }

    .noteText{
      position:absolute;
      inset:0;
      padding:22px 26px 18px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      font-family:Caveat, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--ink);
      font-size:34px;
      line-height:1.05;
      letter-spacing:.2px;
      opacity:0;
      transform: translateY(6px);
      transition: opacity 520ms var(--ease), transform 520ms var(--ease);
      z-index:2;
      text-shadow: 0 1px 0 rgba(255,255,255,.12);
    }
    .noteText .inner{
      width:min(92%, 420px);
      color:var(--ink);
    }

    .hint{
      margin-top:8px;
      font-size:12px;
      color:var(--muted2);
      letter-spacing:.2px;
    }

    .folds{
      position:absolute; inset:0;
      pointer-events:none;
      z-index:3;
      opacity:0;
      transition: opacity 900ms var(--ease);
    }
    .folds::before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(120deg, rgba(0,0,0,.14), transparent 35%, rgba(0,0,0,.10)),
        linear-gradient(-120deg, rgba(0,0,0,.12), transparent 35%, rgba(0,0,0,.08)),
        radial-gradient(220px 140px at 30% 45%, rgba(0,0,0,.18), transparent 60%),
        radial-gradient(220px 160px at 70% 60%, rgba(0,0,0,.14), transparent 62%);
      mix-blend-mode:multiply;
      filter: blur(.6px);
      opacity:.9;
    }

    .scrunch{
      position:absolute; inset:0;
      pointer-events:none;
      z-index:4;
      opacity:0;
      transition: opacity 900ms var(--ease);
    }
    .scrunch::before{
      content:"";
      position:absolute; inset:-10px;
      background:
        radial-gradient(70px 40px at 22% 26%, rgba(0,0,0,.24), transparent 68%),
        radial-gradient(90px 55px at 55% 18%, rgba(0,0,0,.22), transparent 70%),
        radial-gradient(110px 70px at 80% 35%, rgba(0,0,0,.22), transparent 72%),
        radial-gradient(120px 80px at 30% 70%, rgba(0,0,0,.24), transparent 72%),
        radial-gradient(140px 90px at 72% 78%, rgba(0,0,0,.22), transparent 75%);
      mix-blend-mode:multiply;
      filter: blur(1.1px);
      opacity:1;
    }

    .app.state0 .paper{
      transform: scale(.78) rotate(-6deg);
    }
    .app.state0 .sheet{
      clip-path: polygon(38% 22%, 62% 20%, 74% 34%, 70% 66%, 55% 78%, 36% 73%, 26% 58%, 28% 34%);
      filter: saturate(.92) contrast(1.05) blur(.7px);
      transform: rotate(1.5deg) scale(1.03);
    }
    .app.state0 .scrunch{opacity:1}
    .app.state0 .folds{opacity:.65}

    .app.state1 .paper{
      transform: scale(.92) rotate(-2.5deg);
    }
    .app.state1 .sheet{
      clip-path: polygon(10% 10%, 92% 9%, 95% 19%, 96% 78%, 90% 92%, 14% 92%, 7% 82%, 6% 19%);
      filter: saturate(.98) contrast(1.02) blur(.15px);
      transform: rotate(.4deg) scale(1.01);
    }
    .app.state1 .scrunch{opacity:.32}
    .app.state1 .folds{opacity:.5}

    .app.state2 .paper{
      transform: scale(1) rotate(0deg);
    }
    .app.state2 .sheet{
      clip-path: polygon(6% 8%, 94% 7%, 96% 16%, 96% 82%, 88% 93%, 14% 92%, 6% 86%, 5% 18%);
      filter: saturate(1) contrast(1) blur(0);
      transform: rotate(0deg) scale(1);
    }
    .app.state2 .noteText{
      opacity:1;
      transform: translateY(0);
    }
    .app.state2 .scrunch{opacity:0}
    .app.state2 .folds{opacity:.22}

    .weather{
      margin:10px auto 6px;
      width:min(520px, 100%);
      padding:14px 14px 12px;
      border-radius:18px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      display:none;
    }
    .wtitle{
      font-size:13px;
      color:var(--muted2);
      margin-bottom:8px;
      letter-spacing:.2px;
    }
    .wmain{
      font-size:16px;
      color:var(--white);
      margin-bottom:6px;
    }
    .wadvice{
      font-size:13px;
      color:var(--muted);
    }

    .footerLine{
      margin:14px 0 12px;
      font-size:13px;
      color:var(--muted2);
    }

    .buttons{
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:6px;
    }
    .btn{
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.08);
      color:var(--white);
      padding:10px 14px;
      border-radius:999px;
      font-size:14px;
      font-weight:500;
      cursor:pointer;
      transition: transform 180ms var(--ease), background 180ms var(--ease), border-color 180ms var(--ease);
      -webkit-tap-highlight-color:transparent;
    }
    .btn:active{transform:scale(.98)}
    .btn.secondary{
      background:rgba(255,255,255,.05);
      color:var(--muted);
    }

    .modal{
      position:fixed; inset:0;
      background:rgba(0,0,0,.72);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .modalCard{
      width:min(560px, 100%);
      max-height:min(78vh, 720px);
      overflow:auto;
      border-radius:22px;
      background:rgba(15,15,15,.92);
      border:1px solid rgba(255,255,255,.14);
      box-shadow:0 25px 60px rgba(0,0,0,.65);
      padding:14px 14px 10px;
    }
    .modalTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:6px 6px 10px;
    }
    .modalTop .title{
      font-size:14px;
      font-weight:600;
      color:var(--white);
      letter-spacing:.2px;
    }
    .x{
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--white);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-size:13px;
    }
    .cards{
      display:grid;
      gap:10px;
      padding:0 6px 8px;
    }
    .card{
      border-radius:18px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      padding:12px 12px 10px;
    }
    .meta{
      font-size:12px;
      color:var(--muted2);
      margin-bottom:8px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .msg{
      font-family:Caveat, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      font-size:24px;
      color:var(--white);
      line-height:1.05;
    }

    @media (max-width:420px){
      h1{font-size:24px}
      .noteText{font-size:30px; padding:20px 22px 16px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="app state0" id="app">
      <h1>A Note For You</h1>
      <div class="date" id="todayLabel">—</div>

      <div class="chips">
        <div class="chip" id="togetherLabel">Together —</div>
        <div class="chip"><strong id="togetherDays">—</strong> days</div>
      </div>

      <div class="paperStage">
        <div class="paper" id="paper" role="button" aria-label="Open note" tabindex="0">
          <div class="sheet"></div>
          <div class="folds"></div>
          <div class="scrunch"></div>
          <div class="noteText" id="noteText"><div class="inner"></div></div>
        </div>
      </div>

      <div class="hint" id="hint">Tap once… then tap again.</div>

      <div class="weather" id="weatherBox">
        <div class="wtitle">Today in Odense</div>
        <div class="wmain" id="weatherMain">—</div>
        <div class="wadvice" id="weatherAdvice">—</div>
      </div>

      <div class="footerLine" id="footerLine">I’ll leave another note for you tomorrow.</div>

      <div class="buttons">
        <button class="btn secondary" id="openArchive">Archive</button>
        <button class="btn secondary" id="resetBtn">Reset (this phone)</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modal">
    <div class="modalCard">
      <div class="modalTop">
        <div class="title">Archive</div>
        <button class="x" id="closeModal">Close</button>
      </div>
      <div class="cards" id="archiveList"></div>
    </div>
  </div>

  <script>
    const START_DATE = "2022-07-03";
    const CITY_LAT = 55.4038;
    const CITY_LON = 10.4024;

    const NOTES = [
      "You make me feel safe and loved. Thank you.",
      "I’m proud of you. Always.",
      "You’re doing better than you think you are.",
      "I love the way you handle life — with so much heart.",
      "You don’t have to be perfect. You’re already enough for me.",
      "I’m grateful for you. Every single day.",
      "I notice your effort. I see your growth. I’m proud of you.",
      "You’re my favorite person to come home to — even from far away.",
      "Your kindness is one of the most beautiful things about you.",
      "I believe in you, even on the days you don’t.",
      "I love how gentle you are, even when life is heavy.",
      "I’m so happy you got a good internship. You deserve it.",
      "You’re improving so much. I’m genuinely proud of you.",
      "I love your voice, your laugh, your way of being.",
      "You make the world feel softer for me.",
      "I can’t wait to live with you and do the little things together.",
      "Thank you for being so sweet to me. I feel lucky.",
      "If today is hard, remember: I’m on your side. Always.",
      "You’re not alone. I’m here, cheering for you.",
      "I love the way you love — it’s warm and real.",
      "You make me want to be better, in the best way.",
      "I’m proud of how you keep going. That takes strength.",
      "I love our story. I love our future.",
      "You deserve calm days and gentle nights.",
      "I’m grateful for your patience, your care, your heart.",
      "You’re the only person I want to choose, again and again.",
      "I’m so proud of the woman you’re becoming.",
      "You are loved — more than you know.",
      "Even far away, you’re still my home.",
      "I’ll always choose you."
    ];

    const app = document.getElementById("app");
    const paper = document.getElementById("paper");
    const noteTextEl = document.getElementById("noteText").querySelector(".inner");
    const todayLabel = document.getElementById("todayLabel");
    const togetherLabel = document.getElementById("togetherLabel");
    const togetherDaysEl = document.getElementById("togetherDays");
    const hint = document.getElementById("hint");
    const footerLine = document.getElementById("footerLine");

    const weatherBox = document.getElementById("weatherBox");
    const weatherMain = document.getElementById("weatherMain");
    const weatherAdviceEl = document.getElementById("weatherAdvice");

    const modal = document.getElementById("modal");
    const openArchiveBtn = document.getElementById("openArchive");
    const closeModalBtn = document.getElementById("closeModal");
    const archiveList = document.getElementById("archiveList");
    const resetBtn = document.getElementById("resetBtn");

    function pad2(n){ return String(n).padStart(2,"0"); }
    function isoDate(d){
      return d.getFullYear()+"-"+pad2(d.getMonth()+1)+"-"+pad2(d.getDate());
    }
    function isoDateTime(d){
      return d.getFullYear()+"-"+pad2(d.getMonth()+1)+"-"+pad2(d.getDate())+" "+pad2(d.getHours())+":"+pad2(d.getMinutes());
    }
    function startOfDay(d){
      return new Date(d.getFullYear(), d.getMonth(), d.getDate());
    }
    function dayDiff(a,b){
      const A = startOfDay(a).getTime();
      const B = startOfDay(b).getTime();
      return Math.floor((B-A)/86400000);
    }
    function formatLongDate(d){
      return d.toLocaleDateString(undefined, { weekday:"long", year:"numeric", month:"long", day:"numeric" });
    }
    function formatDurationFromStart(startIso, now){
      const s = new Date(startIso+"T00:00:00");
      let years = now.getFullYear() - s.getFullYear();
      let months = now.getMonth() - s.getMonth();
      let days = now.getDate() - s.getDate();

      if(days < 0){
        const prevMonth = new Date(now.getFullYear(), now.getMonth(), 0);
        days += prevMonth.getDate();
        months -= 1;
      }
      if(months < 0){
        months += 12;
        years -= 1;
      }

      const parts = [];
      if(years > 0) parts.push(years+" year"+(years===1?"":"s"));
      if(months > 0) parts.push(months+" month"+(months===1?"":"s"));
      parts.push(days+" day"+(days===1?"":"s"));
      return parts.join(", ");
    }

    function loadState(){
      try{
        const raw = localStorage.getItem("note_state_v3");
        if(!raw) return { opened:{}, archive:[] };
        const s = JSON.parse(raw);
        if(!s || typeof s !== "object") return { opened:{}, archive:[] };
        if(!s.opened) s.opened = {};
        if(!s.archive) s.archive = [];
        return s;
      }catch(e){
        return { opened:{}, archive:[] };
      }
    }
    function saveState(s){
      localStorage.setItem("note_state_v3", JSON.stringify(s));
    }

    function pickNoteForDay(dateIso){
      const start = new Date(START_DATE+"T00:00:00");
      const now = new Date(dateIso+"T00:00:00");
      const idx = Math.abs(dayDiff(start, now)) % NOTES.length;
      return { idx, text: NOTES[idx] };
    }

    function weatherText(code){
      const map = {
        0:"Clear",
        1:"Mostly clear",
        2:"Partly cloudy",
        3:"Overcast",
        45:"Fog",
        48:"Depositing rime fog",
        51:"Light drizzle",
        53:"Drizzle",
        55:"Heavy drizzle",
        56:"Freezing drizzle",
        57:"Freezing drizzle",
        61:"Light rain",
        63:"Rain",
        65:"Heavy rain",
        66:"Freezing rain",
        67:"Freezing rain",
        71:"Light snow",
        73:"Snow",
        75:"Heavy snow",
        77:"Snow grains",
        80:"Rain showers",
        81:"Rain showers",
        82:"Violent showers",
        85:"Snow showers",
        86:"Snow showers",
        95:"Thunderstorm",
        96:"Thunderstorm",
        99:"Thunderstorm"
      };
      return map[code] || "Weather";
    }

    function windLabel(kmh){
      if(kmh < 10) return "Light wind";
      if(kmh < 22) return "Breezy";
      if(kmh < 35) return "Windy";
      return "Very windy";
    }

    function advice(tempC, code, windKmh){
      if(code >= 61 && code <= 82) return "Maybe take an umbrella.";
      if(code >= 71 && code <= 86) return "Dress warm today.";
      if(windKmh >= 22 && tempC < 12) return "A warm jacket might be nice.";
      if(tempC <= 2) return "Bundle up today.";
      if(tempC < 8) return "A warm jacket might be nice.";
      if(tempC >= 22) return "A light outfit might be nice.";
      return "Have a soft day.";
    }

    async function showWeather(){
      try{
        const url = "https://api.open-meteo.com/v1/forecast?latitude="+encodeURIComponent(CITY_LAT)+"&longitude="+encodeURIComponent(CITY_LON)+"&current_weather=true&timezone=auto&windspeed_unit=kmh";
        const res = await fetch(url, { cache:"no-store" });
        const json = await res.json();
        const cw = json.current_weather;
        if(!cw) return;

        const t = Math.round(cw.temperature);
        const code = cw.weathercode;
        const ws = Math.round(cw.windspeed);
        const wt = weatherText(code);
        const wl = windLabel(ws);
        const adv = advice(t, code, ws);

        weatherMain.textContent = t+"°C · "+wt+" · "+wl;
        weatherAdviceEl.textContent = adv;
        weatherBox.style.display = "block";
      }catch(e){}
    }

    function renderArchive(state){
      const items = [...state.archive].sort((a,b) => (b.openedAt||"").localeCompare(a.openedAt||""));
      archiveList.innerHTML = "";
      if(!items.length){
        const empty = document.createElement("div");
        empty.className = "card";
        empty.innerHTML = '<div class="meta"><span>—</span><span>—</span></div><div class="msg">No opened notes yet.</div>';
        archiveList.appendChild(empty);
        return;
      }
      for(const it of items){
        const card = document.createElement("div");
        card.className = "card";
        const meta = document.createElement("div");
        meta.className = "meta";
        meta.innerHTML = "<span>"+(it.date || "—")+"</span><span>Opened: "+(it.openedAt || "—")+"</span>";
        const msg = document.createElement("div");
        msg.className = "msg";
        msg.textContent = it.text || "";
        card.appendChild(meta);
        card.appendChild(msg);
        archiveList.appendChild(card);
      }
    }

    function setState(n){
      app.classList.remove("state0","state1","state2");
      app.classList.add("state"+n);
    }

    function lockFor(ms){
      paper.style.pointerEvents = "none";
      setTimeout(() => { paper.style.pointerEvents = "auto"; }, ms);
    }

    function init(){
      const now = new Date();
      const todayIso = isoDate(now);

      todayLabel.textContent = formatLongDate(now);

      const togetherDays = dayDiff(new Date(START_DATE+"T00:00:00"), now);
      togetherDaysEl.textContent = String(togetherDays);

      const togetherHuman = formatDurationFromStart(START_DATE, now);
      togetherLabel.textContent = "Together for "+togetherHuman;

      const state = loadState();
      const openedToday = !!state.opened[todayIso];

      const note = pickNoteForDay(todayIso);
      noteTextEl.textContent = note.text;

      if(openedToday){
        setState(2);
        hint.textContent = "Good morning.";
        footerLine.textContent = "I’ll leave another note for you tomorrow.";
        weatherBox.style.display = "block";
        showWeather();
      }else{
        setState(0);
        hint.textContent = "Tap once… then tap again.";
        footerLine.textContent = "I’ll leave another note for you tomorrow.";
        showWeather();
      }

      let tapState = openedToday ? 2 : 0;

      function onTap(){
        const currentState = loadState();
        const alreadyOpened = !!currentState.opened[todayIso];

        if(alreadyOpened){
          tapState = 2;
          setState(2);
          return;
        }

        if(tapState === 0){
          tapState = 1;
          setState(1);
          hint.textContent = "One more tap…";
          lockFor(700);
          return;
        }

        if(tapState === 1){
          tapState = 2;
          setState(2);
          hint.textContent = "Good morning.";
          lockFor(650);

          currentState.opened[todayIso] = true;
          currentState.archive.push({
            date: todayIso,
            text: note.text,
            openedAt: isoDateTime(new Date())
          });
          saveState(currentState);

          return;
        }
      }

      paper.addEventListener("click", onTap);
      paper.addEventListener("keydown", (e) => {
        if(e.key === "Enter" || e.key === " "){
          e.preventDefault();
          onTap();
        }
      });

      openArchiveBtn.addEventListener("click", () => {
        const s = loadState();
        renderArchive(s);
        modal.style.display = "flex";
      });

      closeModalBtn.addEventListener("click", () => {
        modal.style.display = "none";
      });

      modal.addEventListener("click", (e) => {
        if(e.target === modal) modal.style.display = "none";
      });

      resetBtn.addEventListener("click", () => {
        localStorage.removeItem("note_state_v3");
        location.reload();
      });
    }

    init();
  </script>
</body>
</html>
